Единый канал: Вместо двух несвязанных каналов in и out используется один contentChan для передачи данных от ScanFiles к CheckPhrase.
Правильный запуск горутин: Горутины CheckPhrase запускаются в цикле, и для каждой из них вызывается wg.Add(1).[7]
Закрытие канала: После того как ScanFiles прочитала все файлы и отправила их содержимое в канал, она закрывает канал с помощью close(contentChan). Это является сигналом для горутин CheckPhrase, которые читают данные из канала в цикле for range, что данных больше не будет, и они могут завершить свою работу.[5]
Правильное ожидание: Вызов wg.Wait() перенесен в конец функции main. Это гарантирует, что основная программа дождется выполнения всех горутин CheckPhrase перед своим завершением.[6][8]
Чтение из канала в цикле: CheckPhrase теперь использует конструкцию for content := range in для чтения всех данных из канала до его закрытия. Это стандартный паттерн для обработки данных от нескольких производителей.